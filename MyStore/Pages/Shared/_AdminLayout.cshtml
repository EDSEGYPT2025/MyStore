<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - لوحة التحكم</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.rtl.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="~/css/admin_layout.css" asp-append-version="true" />
</head>
<body>
    <nav class="sidebar" id="admin-sidebar">
        <a class="sidebar-brand" asp-page="/Index">
            <i class="fas fa-store-alt"></i>
            <span>MyStore Panel</span>
        </a>
        <div class="sidebar-nav">
            <ul class="nav flex-column p-0">
                <li class="nav-item">
                    <a class="nav-link" asp-page="/Admin/Index">
                        <i class="fas fa-tachometer-alt fa-fw"></i> لوحة التحكم
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" asp-page="/Admin/Stores/Index">
                        <i class="fas fa-store fa-fw"></i> إدارة المتاجر
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" asp-page="/Admin/Products/Index">
                        <i class="fas fa-boxes-stacked fa-fw"></i> إدارة المنتجات
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" asp-page="/Admin/Orders/Index">
                        <i class="fas fa-receipt fa-fw"></i> إدارة الطلبات
                    </a>
                </li>
                <li class="nav-item mt-3 border-top pt-3">
                    <a class="nav-link" asp-page="/Index">
                        <i class="fas fa-globe fa-fw"></i> العودة للموقع
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="admin-wrapper">
        <header class="topbar">
            <button class="btn btn-light d-lg-none" id="sidebar-toggler">
                <i class="fas fa-bars"></i>
            </button>
            <partial name="_LoginPartial" />
        </header>

        <main class="main-content">
            @RenderBody()
        </main>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    @await RenderSectionAsync("Scripts", required: false)

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // --- Sidebar Toggle for Mobile ---
            const sidebar = document.getElementById('admin-sidebar');
            const toggler = document.getElementById('sidebar-toggler');
            const overlay = document.getElementById('sidebar-overlay');

            if (toggler) {
                toggler.addEventListener('click', function () {
                    sidebar.classList.toggle('is-open');
                });
            }
            if (overlay) {
                overlay.addEventListener('click', function () {
                    sidebar.classList.remove('is-open');
                });
            }

            // --- Dynamic Active Link Highlighting ---
            const currentPagePath = window.location.pathname.toLowerCase();
            const navLinks = document.querySelectorAll('.sidebar .nav-link');
            let bestMatch = null;

            navLinks.forEach(link => {
                const linkPath = link.getAttribute('href')?.toLowerCase();
                if (linkPath && currentPagePath.startsWith(linkPath)) {
                    // Find the most specific (longest) match
                    if (!bestMatch || linkPath.length > bestMatch.getAttribute('href').length) {
                        bestMatch = link;
                    }
                }
            });

            // Remove 'active' from any pre-set links and apply to the best match
            if (bestMatch) {
                navLinks.forEach(link => link.classList.remove('active'));
                bestMatch.classList.add('active');
            }
        });
    </script>
</body>
</html>