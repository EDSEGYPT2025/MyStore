<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - لوحة تحكم متجري</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="stylesheet" href="~/css/admin_layout.css" asp-append-version="true" />
</head>
<body class="bg-background text-foreground">

    <div class="page-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <i data-lucide="shopping-cart" class="logo-icon"></i>
                <span class="logo-text">MyStore</span>
            </div>
            <nav class="sidebar-nav">
                <a asp-page="/Manager/Index" class="nav-link">
                    <i data-lucide="layout-dashboard"></i><span class="link-text">الرئيسية</span>
                </a>
                <a asp-page="/Manager/Products/Index" class="nav-link">
                    <i data-lucide="package"></i><span class="link-text">إدارة المنتجات</span>
                </a>
                <a asp-page="/Manager/Companies/Index" class="nav-link">
                    <i data-lucide="building-2"></i><span class="link-text">إدارة الماركات</span>
                </a>
                <a asp-page="/Manager/Orders/Index" class="nav-link">
                    <i data-lucide="receipt"></i><span class="link-text">إدارة الطلبات</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="topbar">
                <div class="flex items-center gap-2">
                    <button class="sidebar-toggler hidden lg:flex" id="sidebar-toggler-desktop" aria-label="Toggle sidebar"><i data-lucide="panel-left-close"></i></button>
                    <button class="sidebar-toggler lg:hidden" id="sidebar-toggler-mobile" aria-label="Open sidebar"><i data-lucide="menu"></i></button>
                </div>
                <div class="flex items-center gap-4">
                    <button class="theme-toggler" id="theme-toggler" aria-label="Toggle theme">
                        <i data-lucide="moon" class="icon-dark"></i><i data-lucide="sun" class="icon-light"></i>
                    </button>
                    <div class="h-6 w-px bg-border"></div>
                    <partial name="_LoginPartial" />
                </div>
            </header>
            <div class="page-body">
                @RenderBody()
            </div>
        </main>
    </div>

    <div class="overlay"></div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    @await RenderSectionAsync("Scripts", required: false)

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            try {
                lucide.createIcons();

                const pageWrapper = document.querySelector('.page-wrapper');
                const desktopToggler = document.getElementById('sidebar-toggler-desktop');
                const mobileToggler = document.getElementById('sidebar-toggler-mobile');
                const overlay = document.querySelector('.overlay');
                const themeToggler = document.getElementById('theme-toggler');
                const htmlEl = document.documentElement;

                if (pageWrapper) {
                    desktopToggler?.addEventListener('click', () => pageWrapper.classList.toggle('sidebar-collapsed'));
                    mobileToggler?.addEventListener('click', () => pageWrapper.classList.add('sidebar-visible'));
                    overlay?.addEventListener('click', () => pageWrapper.classList.remove('sidebar-visible'));
                }

                const applyTheme = (theme) => {
                    htmlEl.setAttribute('data-theme', theme);
                    localStorage.setItem('theme', theme);
                };
                themeToggler?.addEventListener('click', () => {
                    const current = htmlEl.getAttribute('data-theme');
                    applyTheme(current === 'light' ? 'dark' : 'light');
                });
                applyTheme(localStorage.getItem('theme') || 'light');

                const navLinks = document.querySelectorAll('.sidebar-nav .nav-link');
                const currentPath = window.location.pathname.toLowerCase();
                let activeLink = null;

                if (currentPath === '/manager' || currentPath === '/manager/') {
                    activeLink = document.querySelector('.sidebar-nav a[asp-page="/Manager/Index"]');
                } else {
                    let longestMatch = 0;
                    navLinks.forEach(link => {
                        const href = link.getAttribute('href')?.toLowerCase();
                        if (href && currentPath.startsWith(href) && href.length > longestMatch) {
                            longestMatch = href.length;
                            activeLink = link;
                        }
                    });
                }

                if (activeLink) {
                    activeLink.classList.add('active');
                }

            } catch (error) {
                console.error("An error occurred in the layout script:", error);
            }
        });
    </script>
</body>
</html>